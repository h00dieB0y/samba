# ----------------------------------------
# Spring Boot Core Settings for Testing
# ----------------------------------------
spring:
  application:
    name: somba-api-test

  profiles:
    active: test

  # ----------------------------------------
  # Override the PostgreSQL DB for Tests
  # ----------------------------------------
  datasource:
    url: jdbc:postgresql://localhost:${DB_PORT:5432}/${DB_NAME:somba_test_db}
    username: ${DB_USER:postgres}
    password: ${DB_PASSWORD:securepassword}
    driver-class-name: org.postgresql.Driver

  # ----------------------------------------
  # Override JPA Behavior for Tests
  # ----------------------------------------
  jpa:
    hibernate:
      ddl-auto: create-drop  # 'create-drop' or 'update' (create-drop is safer for true isolation)
    show-sql: true           # Enable SQL logging for debugging tests
    open-in-view: false
    properties:
      hibernate:
        format_sql: true
        dialect: org.hibernate.dialect.PostgreSQLDialect

  # ----------------------------------------
  # MongoDB for Tests
  # ----------------------------------------
  data:
    mongodb:
      host: localhost
      port: ${MONGO_PORT:27017}
      database: ${MONGO_DB:somba_test_catalog}
      username: ${MONGO_INITDB_ROOT_USERNAME:root}
      password: ${MONGO_INITDB_ROOT_PASSWORD:securepassword}
      authentication-database: admin

  # ----------------------------------------
  # Elasticsearch for Tests
  # ----------------------------------------
  elasticsearch:
    uris: ${ELASTICSEARCH_URL:http://localhost:9200}
    connection-timeout: 1s

# ----------------------------------------
# Override Server Port to Avoid Conflicts
# ----------------------------------------
server:
  port: ${APP_PORT:8082}
  servlet:
    context-path: /api/${API_VERSION:v1}

# ----------------------------------------
# Logging Configuration for Testing
# ----------------------------------------
logging:
  level:
    root: INFO
    org.springframework: DEBUG  # Increase verbosity for debugging
    com.somba: DEBUG
  pattern:
    console: "%d{yyyy-MM-dd HH:mm:ss} - [%thread] %-5level %logger{36} - %msg%n"

# ----------------------------------------
# CORS Configuration for Testing
# ----------------------------------------
cors:
  allowed-origins: "*"
  allowed-methods: "GET,POST,PUT,DELETE,OPTIONS"
  allowed-headers: "*"
  exposed-headers: "Authorization"

# ----------------------------------------
# API Versioning for Testing
# ----------------------------------------
api:
  version: ${API_VERSION:test_v1}
